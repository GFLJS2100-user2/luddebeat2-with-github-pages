RATE=44100,
FOURIER_N=31,
t=t/RATE,
BPM=156,
BEAT_DIV=1/BPM*60/2,
MEASURE_LEN=16,
beat_num=floor(t/BEAT_DIV)%MEASURE_LEN,
beat_prog=t/BEAT_DIV%BEAT_DIV,
mn=floor(t/(MEASURE_LEN*BEAT_DIV)),
mtl=BEAT_DIV*MEASURE_LEN,
mp=(t%mtl)/mtl,
fourier=(fn,n,hz,t)=>(n?fn(n)*sin(2*PI*t*hz*n)+fourier(fn,n-1,hz,t):0),
sq=n=>n&1?1/n:0,
saw=n=>1/n,
tri=n=>n&1?(.7*((n/2&1)?1:-1)/n/n):0,
lp=(fn,k,n)=>(fn(n)*max(0,1-n/k)),
bp=(fn,k,n)=>(fn(n)*max(0,1-abs(n-k))),
dp=(fn,k,n)=>(fn(n)*max(0,1-n/k)*min(1, n/k)),
ms=(a,m)=>a.map(m).reduce((a,b)=>(a+b)),
nf=(base,st)=>base*pow(pow(2,1/12), st),
chseq=[0x037a,0x057a,0x259c,0x48bf],
ch=(p,s,t)=>ms([0,1,2,3],k=>ms([1,.999],dt=>(b=k*4,fourier(n=>lp(saw,p,n),FOURIER_N,nf(dt*208,(s&(15<<b))>>b),t)/4))),
arp=(k,s,t)=>(sb=k&3,b=k&4?sb:(4-sb),nn=b&4?(12+((s&0xf000)>>12)):(s & (15<<b) >> b),fourier(n=>dp(tri,k+2,n),FOURIER_N,nf(104,nn),t)),
s=chseq[mn%4],
(.6*arp(beat_num,s,t)+(mn>7&&.2*ch(mp*24+1,s,t))+(mn>15&&.2*fourier(n=>bp(sq,69*pow(1-mp,2)+1,n),FOURIER_N*2,nf(104,s&15),t)))*127+128
